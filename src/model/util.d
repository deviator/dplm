module model.util;

import des.math.linear;
import des.math.method.approx.interp;

auto limited(T)( in T val, in T lmax, in T lmin )
    if( isVector!T )
{
    T ret = val;
    assert( ret.length == lmax.length );
    assert( ret.length == lmin.length );
    foreach( i; 0 .. ret.length )
    {
        if( ret[i] > lmax[i] ) ret[i] = lmax[i];
        if( ret[i] < lmin[i] ) ret[i] = lmin[i];
    }
    return ret;
}

float getDepthCorrect( float v )
{
    alias InterpolateTableData!float TV;
    enum tbl = 
        [
        TV(0,0.5),
        TV(0.0209763,0.505299),
        TV(0.0421809,0.510774),
        TV(0.0638236,0.516483),
        TV(0.0874268,0.522856),
        TV(0.107875,0.528505),
        TV(0.128341,0.534284),
        TV(0.152117,0.54116),
        TV(0.175213,0.548009),
        TV(0.197643,0.554828),
        TV(0.219279,0.56157),
        TV(0.240432,0.568323),
        TV(0.260925,0.57502),
        TV(0.280982,0.581728),
        TV(0.30416,0.589676),
        TV(0.326686,0.597617),
        TV(0.348382,0.605465),
        TV(0.369753,0.613404),
        TV(0.390646,0.621366),
        TV(0.410813,0.629252),
        TV(0.433236,0.63826),
        TV(0.454966,0.647233),
        TV(0.476434,0.656353),
        TV(0.497162,0.665407),
        TV(0.517506,0.674537),
        TV(0.539509,0.684704),
        TV(0.56071,0.694787),
        TV(0.581509,0.704973),
        TV(0.601638,0.715119),
        TV(0.623253,0.726345),
        TV(0.644318,0.737634),
        TV(0.664892,0.748997),
        TV(0.68668,0.761427),
        TV(0.707765,0.77385),
        TV(0.728183,0.786275),
        TV(0.749517,0.799688),
        TV(0.770402,0.813272),
        TV(0.79079,0.826984),
        TV(0.811117,0.84112),
        TV(0.831847,0.856052),
        TV(0.853236,0.872018),
        TV(0.873748,0.8879),
        TV(0.894978,0.904955),
        TV(0.915373,0.921969),
        TV(0.936218,0.940049),
        TV(0.956437,0.958263),
        TV(0.977172,0.977681),
        TV(0.998025,0.998034),
        TV(1,1)
        ];
    return lineInterpolate( tbl, v, true );
}
