module model.util;

import des.math.linear;
import des.math.method.approx.interp;

auto limited(T)( in T val, in T lmax, in T lmin )
    if( isVector!T )
{
    T ret = val;
    assert( ret.length == lmax.length );
    assert( ret.length == lmin.length );
    foreach( i; 0 .. ret.length )
    {
        if( ret[i] > lmax[i] ) ret[i] = lmax[i];
        if( ret[i] < lmin[i] ) ret[i] = lmin[i];
    }
    return ret;
}

float getDepthRelativeError( float v )
{
    alias InterpolateTableData!float TV;
    enum tbl = 
        [
            TV(0, 0),
            TV(0.0209763, 0.010377),
            TV(0.0421809, 0.020636),
            TV(0.0638236, 0.0308598),
            TV(0.0874268, 0.0417152),
            TV(0.107875, 0.0508625),
            TV(0.128341, 0.0597704),
            TV(0.152117, 0.0697973),
            TV(0.175213, 0.0791947),
            TV(0.197643, 0.0879852),
            TV(0.219279, 0.0961384),
            TV(0.240432, 0.103789),
            TV(0.260925, 0.110888),
            TV(0.280982, 0.117527),
            TV(0.30416, 0.124804),
            TV(0.326686, 0.131453),
            TV(0.348382, 0.137449),
            TV(0.369753, 0.142945),
            TV(0.390646, 0.147912),
            TV(0.410813, 0.152308),
            TV(0.433236, 0.156719),
            TV(0.454966, 0.160497),
            TV(0.476434, 0.163725),
            TV(0.497162, 0.166347),
            TV(0.517506, 0.168429),
            TV(0.539509, 0.170105),
            TV(0.56071, 0.171136),
            TV(0.581509, 0.171561),
            TV(0.601638, 0.171395),
            TV(0.623253, 0.170556),
            TV(0.644318, 0.169047),
            TV(0.664892, 0.16689),
            TV(0.68668, 0.163823),
            TV(0.707765, 0.160061),
            TV(0.728183, 0.155631),
            TV(0.749517, 0.150137),
            TV(0.770402, 0.143856),
            TV(0.79079, 0.136819),
            TV(0.811117, 0.12887),
            TV(0.831847, 0.119743),
            TV(0.853236, 0.109199),
            TV(0.873748, 0.0979474),
            TV(0.894978, 0.085063),
            TV(0.915373, 0.0714276),
            TV(0.936218, 0.0561277),
            TV(0.956437, 0.0399187),
            TV(0.977172, 0.0218095),
            TV(0.998025, 0.00196248),
            TV(1, 0)
        ];
    return lineInterpolate( tbl, v, true ) / v;
}

