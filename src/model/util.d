module model.util;

import des.math.linear;
import des.math.method.approx.interp;

auto limited(T)( in T val, in T lmax, in T lmin )
    if( isVector!T )
{
    T ret = val;
    assert( ret.length == lmax.length );
    assert( ret.length == lmin.length );
    foreach( i; 0 .. ret.length )
    {
        if( ret[i] > lmax[i] ) ret[i] = lmax[i];
        if( ret[i] < lmin[i] ) ret[i] = lmin[i];
    }
    return ret;
}

float getDepthRelativeError( float v )
{
    alias InterpolateTableData!float TV;
    enum tbl = 
        [
        TV(0,0.5),
        TV(0.0209763,0.494701),
        TV(0.0421809,0.489226),
        TV(0.0638236,0.483517),
        TV(0.0874268,0.477144),
        TV(0.107875,0.471495),
        TV(0.128341,0.465716),
        TV(0.152117,0.45884),
        TV(0.175213,0.451991),
        TV(0.197643,0.445172),
        TV(0.219279,0.43843),
        TV(0.240432,0.431677),
        TV(0.260925,0.42498),
        TV(0.280982,0.418272),
        TV(0.30416,0.410324),
        TV(0.326686,0.402383),
        TV(0.348382,0.394535),
        TV(0.369753,0.386596),
        TV(0.390646,0.378634),
        TV(0.410813,0.370748),
        TV(0.433236,0.36174),
        TV(0.454966,0.352767),
        TV(0.476434,0.343647),
        TV(0.497162,0.334593),
        TV(0.517506,0.325463),
        TV(0.539509,0.315296),
        TV(0.56071,0.305213),
        TV(0.581509,0.295027),
        TV(0.601638,0.284881),
        TV(0.623253,0.273655),
        TV(0.644318,0.262366),
        TV(0.664892,0.251003),
        TV(0.68668,0.238573),
        TV(0.707765,0.22615),
        TV(0.728183,0.213725),
        TV(0.749517,0.200312),
        TV(0.770402,0.186728),
        TV(0.79079,0.173016),
        TV(0.811117,0.15888),
        TV(0.831847,0.143948),
        TV(0.853236,0.127982),
        TV(0.873748,0.1121),
        TV(0.894978,0.0950448),
        TV(0.915373,0.0780311),
        TV(0.936218,0.0599515),
        TV(0.956437,0.0417369),
        TV(0.977172,0.022319),
        TV(0.998025,0.00196636),
        TV(1,0)
        ];
    return lineInterpolate( tbl, v, true );
}
